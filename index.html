<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetlyzer - Sistema de Gestión de Reuniones</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
        }
        
        .form-input {
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }
        
        .form-input:focus {
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .priority-high {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .priority-medium {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        
        .priority-low {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        
        .meeting-card {
            transition: all 0.3s ease;
        }
        
        .meeting-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        @media print {
            body {
                background: white !important;
            }
            .glass-effect {
                background: white !important;
                backdrop-filter: none !important;
                border: 1px solid #e2e8f0 !important;
            }
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass-effect rounded-2xl p-8 mb-6 shadow-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-sky-500 to-blue-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold gradient-text">Meetlyzer</h1>
                        <p class="text-gray-600 font-medium">Sistema Profesional de Gestión de Reuniones</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Reunión No.:</div>
                    <div id="meetingNumber" class="text-2xl font-bold text-blue-600">#0001</div>
                </div>
            </div>
        </div>

        <!-- Main Form -->
        <div class="glass-effect rounded-2xl p-8 shadow-2xl">
            <form id="meetingForm">
                <!-- Información General -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                        Información General de la Reunión
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Título/Asunto de la Reunión</label>
                            <input type="text" id="meetingTitle" placeholder="Ej: Revisión Mensual de Proyectos Q4" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Tipo de Reunión</label>
                            <select id="meetingType" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                                <option value="">Seleccionar tipo...</option>
                                <option value="estrategica">Estratégica</option>
                                <option value="operativa">Operativa</option>
                                <option value="seguimiento">Seguimiento</option>
                                <option value="planificacion">Planificación</option>
                                <option value="revision">Revisión</option>
                                <option value="brainstorming">Brainstorming</option>
                                <option value="capacitacion">Capacitación</option>
                                <option value="presentacion">Presentación</option>
                                <option value="comite">Comité</option>
                                <option value="directorio">Directorio</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Fecha de la Reunión</label>
                            <input type="date" id="meetingDate" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Hora de Inicio</label>
                            <input type="time" id="startTime" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Hora de Fin</label>
                            <input type="time" id="endTime" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Modalidad</label>
                            <select id="modality" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                                <option value="presencial">Presencial</option>
                                <option value="virtual">Virtual</option>
                                <option value="hibrida">Híbrida</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Lugar/Plataforma</label>
                            <input type="text" id="location" placeholder="Ej: Sala de Juntas A / Zoom / Teams" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Organizador/Moderador</label>
                            <input type="text" id="organizer" placeholder="Nombre del organizador" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Participantes -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-user-friends text-green-600 mr-3"></i>
                        Participantes y Asistencia
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Asistentes Confirmados</label>
                            <textarea id="attendees" rows="4" placeholder="• Juan Pérez - Director General&#10;• María González - Jefa de Proyectos&#10;• Carlos Ruiz - Analista Senior" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ausentes Justificados</label>
                            <textarea id="absentees" rows="4" placeholder="• Ana López - Vacaciones&#10;• Pedro Martín - Viaje de negocios" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Invitados Externos</label>
                            <textarea id="externalGuests" rows="3" placeholder="• Consultor ABC - asesor@consultora.com&#10;• Cliente XYZ - contacto@cliente.com" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Total de Participantes</label>
                            <input type="number" id="totalParticipants" min="1" placeholder="8" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Contenido de la Reunión -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-clipboard-list text-purple-600 mr-3"></i>
                        Contenido y Desarrollo
                    </h2>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Objetivos de la Reunión</label>
                        <textarea id="objectives" rows="3" placeholder="• Revisar el progreso del Q4&#10;• Definir estrategia para el próximo trimestre&#10;• Aprobar presupuesto 2024" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Agenda/Puntos Tratados</label>
                        <textarea id="agenda" rows="5" placeholder="1. Bienvenida y introducción (10 min)&#10;2. Revisión de proyectos actuales (30 min)&#10;3. Análisis de resultados Q4 (20 min)&#10;4. Planificación Q1 2024 (25 min)&#10;5. Otros temas y cierre (10 min)" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Decisiones Tomadas</label>
                            <textarea id="decisions" rows="4" placeholder="• Aprobado presupuesto adicional para Proyecto Alpha&#10;• Se posterga lanzamiento del Producto B hasta marzo&#10;• Contratación de 2 desarrolladores adicionales" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Acuerdos Alcanzados</label>
                            <textarea id="agreements" rows="4" placeholder="• Reuniones de seguimiento semanales los lunes&#10;• Reportes de progreso cada viernes&#10;• Revisión mensual de KPIs" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Tareas y Seguimiento -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-tasks text-orange-600 mr-3"></i>
                        Tareas y Seguimiento
                    </h2>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Acciones Asignadas</label>
                        <textarea id="assignedTasks" rows="6" placeholder="• María González - Preparar documento de requisitos | Fecha límite: 15/12/2023 | Prioridad: Alta&#10;• Carlos Ruiz - Analizar costos del nuevo sistema | Fecha límite: 20/12/2023 | Prioridad: Media&#10;• Juan Pérez - Coordinar reunión con proveedores | Fecha límite: 18/12/2023 | Prioridad: Alta" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Puntos Pendientes</label>
                            <textarea id="pendingItems" rows="4" placeholder="• Definir métricas de éxito para Q1&#10;• Revisar contratos con proveedores actuales&#10;• Validar disponibilidad de recursos técnicos" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Próxima Reunión</label>
                            <div class="space-y-3">
                                <input type="date" id="nextMeetingDate" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                                <input type="text" id="nextMeetingTopic" placeholder="Tema de la próxima reunión" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recursos y Documentos -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-folder-open text-indigo-600 mr-3"></i>
                        Recursos y Documentación
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Documentos Compartidos</label>
                            <textarea id="sharedDocuments" rows="4" placeholder="• Presentación Q4 Results.pptx&#10;• Budget_2024_Draft.xlsx&#10;• Project_Alpha_Timeline.pdf&#10;• Market_Analysis_Report.docx" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Enlaces de Referencia</label>
                            <textarea id="referenceLinks" rows="4" placeholder="• Dashboard de proyectos: https://dashboard.empresa.com&#10;• Repositorio de documentos: https://docs.empresa.com&#10;• Sistema de tickets: https://tickets.empresa.com" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Notas y Observaciones -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-sticky-note text-yellow-600 mr-3"></i>
                        Notas y Observaciones
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Notas Adicionales</label>
                            <textarea id="additionalNotes" rows="5" placeholder="• Excelente participación del equipo&#10;• Se identificaron nuevas oportunidades de mejora&#10;• Necesario reforzar comunicación interdepartamental&#10;• Cliente mostró satisfacción con los avances" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Observaciones del Moderador</label>
                            <textarea id="moderatorNotes" rows="5" placeholder="• Reunión muy productiva y enfocada&#10;• Todos los puntos de agenda fueron cubiertos&#10;• Se superaron las expectativas de participación&#10;• Recomendación: mantener este formato para futuras reuniones" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Información del Redactor -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-user-edit text-teal-600 mr-3"></i>
                        Información del Redactor
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Secretario/Redactor</label>
                            <input type="text" id="secretary" placeholder="Nombre del redactor" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Departamento/Área</label>
                            <input type="text" id="department" placeholder="Ej: Administración, RRHH, IT" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Email de Contacto</label>
                            <input type="email" id="secretaryEmail" placeholder="secretario@empresa.com" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="flex flex-col sm:flex-row gap-4 pt-8 border-t border-gray-200">
                    <button type="button" id="previewBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-eye mr-2"></i>
                        Vista Previa
                    </button>
                    
                    <button type="button" id="saveBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i>
                        Guardar Borrador
                    </button>
                    
                    <button type="button" id="generateBtn" class="flex-1 btn-primary text-white font-semibold py-4 px-6 rounded-lg flex items-center justify-center">
                        <i class="fas fa-file-pdf mr-2"></i>
                        Finalizar y Generar PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Vista Previa -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-5xl max-h-96 overflow-y-auto p-8 w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Vista Previa del Informe de Reunión</h2>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="previewContent" class="space-y-4"></div>
        </div>
    </div>

   // ==================== NUEVO RENDER POTENTE DEL INFORME ====================
// Helpers de formato (PDF)
function mm(text, doc) {
    // ancho del texto en mm a partir de unidades de jsPDF
    return doc.getTextWidth(text);
}
function ensureSpace(doc, yPos, needed, marginTop = 20) {
    if (yPos + needed > 285) {
        doc.addPage();
        return marginTop;
    }
    return yPos;
}
function drawDivider(doc, x, y, w) {
    doc.setDrawColor(226, 232, 240); // gris claro
    doc.setLineWidth(0.5);
    if (doc.setLineDash) doc.setLineDash([1.5, 2]);
    doc.line(x, y, x + w, y);
    if (doc.setLineDash) doc.setLineDash([]);
}
function drawSectionHeader(doc, title, index, x, y, w) {
    // Banda clara
    doc.setFillColor(245, 249, 255);
    doc.roundedRect(x, y, w, 12, 2, 2, 'F');

    // Burbuja índice
    const chipText = String(index).padStart(2, '0');
    doc.setFillColor(14, 165, 233);
    doc.roundedRect(x + 3, y + 2.2, 12, 7.6, 3, 3, 'F');
    doc.setTextColor(255, 255, 255);
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(9);
    doc.text(chipText, x + 9, y + 7.8, { align: 'center', baseline: 'middle' });

    // Título
    doc.setTextColor(37, 99, 235);
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(12);
    doc.text(title, x + 19, y + 8.8);

    return y + 16; // nueva y
}
function drawChip(doc, x, y, label) {
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(9);
    const paddingX = 3.5, paddingY = 2.5;
    const textW = mm(label, doc);
    const w = textW + paddingX * 2;
    doc.setFillColor(230, 244, 255);
    doc.roundedRect(x, y, w, 8.5, 4, 4, 'F');
    doc.setTextColor(14, 165, 233);
    doc.text(label, x + paddingX, y + 6.2);
    return w + 3; // ancho consumido + gap
}
function renderKeyValue(doc, x, y, key, value, maxWidth = 170) {
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(10);
    doc.setTextColor(55, 65, 81);
    const keyText = key + ': ';
    const keyW = mm(keyText, doc);

    doc.setTextColor(17, 24, 39);
    doc.setFont('helvetica', 'normal');
    const lines = doc.splitTextToSize(value || 'No especificado', maxWidth - keyW);
    // clave
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(55, 65, 81);
    doc.text(keyText, x, y);
    // valor
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(17, 24, 39);
    doc.text(lines, x + keyW, y);
    return y + (lines.length * 5.5);
}
function sanitizeList(text) {
    if (!text) return [];
    return text
        .split('\n')
        .map(t => t.trim())
        .filter(t => t.length)
        .map(t => t.replace(/^[-•\d.)\s]+/u, '')); // quita viñetas/num
}
function renderBulletList(doc, x, y, items, maxWidth = 170) {
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(10);
    doc.setTextColor(17, 24, 39);

    const lineH = 5.5;
    items.forEach(item => {
        const lines = doc.splitTextToSize(item, maxWidth - 6);
        // viñeta
        doc.setFont('helvetica', 'bold');
        doc.text('•', x, y);
        // texto
        doc.setFont('helvetica', 'normal');
        lines.forEach((ln, i) => {
            doc.text(ln, x + 6, y);
            y += lineH;
            if (y > 285) {
                doc.addPage();
                y = 20;
            }
        });
    });
    return y + 2; // pequeño espacio tras la lista
}

// ==================== REEMPLAZO: generatePDF() ====================
function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Configuración
    const margin = 20;
    const width = 170;
    const lineH = 6;
    let y = margin;

    // Header potente
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(18);
    doc.setTextColor(14, 165, 233);
    doc.text('INFORME DE REUNIÓN', margin, y);
    y += 8;
    doc.setDrawColor(14, 165, 233);
    doc.setLineWidth(1);
    doc.line(margin, y, 190, y);
    y += 6;

    doc.setFont('helvetica', 'normal');
    doc.setFontSize(10);
    doc.setTextColor(100, 116, 139);
    const meetingNum = document.getElementById('meetingNumber').textContent;
    const now = new Date().toLocaleString('es-ES');
    doc.text('Meetlyzer Pro • Sistema de Gestión de Reuniones', margin, y);
    doc.text(`Reunión: ${meetingNum}`, 140, y);
    y += 6;
    doc.text(`Generado: ${now}`, 140, y);
    y += 8;

    drawDivider(doc, margin, y, width);
    y += 6;

    // Recopilar datos
    const fd = {
        meetingTitle: document.getElementById('meetingTitle').value,
        meetingType: document.getElementById('meetingType').value,
        meetingDate: document.getElementById('meetingDate').value,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        modality: document.getElementById('modality').value,
        location: document.getElementById('location').value,
        organizer: document.getElementById('organizer').value,
        attendees: document.getElementById('attendees').value,
        absentees: document.getElementById('absentees').value,
        externalGuests: document.getElementById('externalGuests').value,
        totalParticipants: document.getElementById('totalParticipants').value,
        objectives: document.getElementById('objectives').value,
        agenda: document.getElementById('agenda').value,
        decisions: document.getElementById('decisions').value,
        agreements: document.getElementById('agreements').value,
        assignedTasks: document.getElementById('assignedTasks').value,
        pendingItems: document.getElementById('pendingItems').value,
        nextMeetingDate: document.getElementById('nextMeetingDate').value,
        nextMeetingTopic: document.getElementById('nextMeetingTopic').value,
        sharedDocuments: document.getElementById('sharedDocuments').value,
        referenceLinks: document.getElementById('referenceLinks').value,
        additionalNotes: document.getElementById('additionalNotes').value,
        moderatorNotes: document.getElementById('moderatorNotes').value,
        secretary: document.getElementById('secretary').value,
        department: document.getElementById('department').value,
        secretaryEmail: document.getElementById('secretaryEmail').value
    };

    // ==================== SECCIÓN 01: RESUMEN ====================
    y = ensureSpace(doc, y, 32);
    y = drawSectionHeader(doc, 'RESUMEN DE LA REUNIÓN', 1, margin, y, width);

    // Título y chips
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(12);
    doc.setTextColor(17, 24, 39);
    doc.text(fd.meetingTitle || 'Título no especificado', margin, y);
    y += 7;

    // Chips fila 1
    let cx = margin;
    cx += drawChip(doc, cx, y - 6, `Tipo: ${fd.meetingType || 'N/D'}`);
    cx += drawChip(doc, cx, y - 6, `Modalidad: ${fd.modality || 'N/D'}`);
    cx += drawChip(doc, cx, y - 6, `Participantes: ${fd.totalParticipants || 'N/D'}`);
    y += 10;

    // Datos clave (2 columnas simuladas)
    const fechaTxt = fd.meetingDate ? new Date(fd.meetingDate).toLocaleDateString('es-ES') : 'No especificada';
    const horarioTxt = `${fd.startTime || 'N/A'} – ${fd.endTime || 'N/A'}`;

    y = renderKeyValue(doc, margin, y, 'Fecha', fechaTxt, 80);
    y = renderKeyValue(doc, margin, y, 'Horario', horarioTxt, 80);

    let yRight = y - 11; // subir para emparejar
    yRight = renderKeyValue(doc, 120, yRight, 'Lugar/Plataforma', fd.location || 'No especificado', 70);
    yRight = renderKeyValue(doc, 120, yRight, 'Organizador', fd.organizer || 'No especificado', 70);
    y = Math.max(y, yRight) + 4;

    drawDivider(doc, margin, y, width);
    y += 6;

    // ==================== SECCIÓN 02: PARTICIPANTES ====================
    y = ensureSpace(doc, y, 40);
    y = drawSectionHeader(doc, 'PARTICIPANTES Y ASISTENCIA', 2, margin, y, width);

    y = renderKeyValue(doc, margin, y, 'Total', fd.totalParticipants || 'No especificado', width);

    const asistentes = sanitizeList(fd.attendees);
    const ausentes = sanitizeList(fd.absentees);
    const externos = sanitizeList(fd.externalGuests);

    doc.setFont('helvetica', 'bold'); doc.setFontSize(10); doc.setTextColor(55, 65, 81);
    doc.text('Asistentes Confirmados', margin, y);
    y += 5;
    y = renderBulletList(doc, margin, y, asistentes.length ? asistentes : ['No especificados'], width);

    y = ensureSpace(doc, y, 20);
    doc.setFont('helvetica', 'bold'); doc.text('Ausentes Justificados', margin, y);
    y += 5;
    y = renderBulletList(doc, margin, y, ausentes.length ? ausentes : ['Ninguno'], width);

    y = ensureSpace(doc, y, 20);
    doc.setFont('helvetica', 'bold'); doc.text('Invitados Externos', margin, y);
    y += 5;
    y = renderBulletList(doc, margin, y, externos.length ? externos : ['Ninguno'], width);

    // ==================== SECCIÓN 03: OBJETIVOS ====================
    y = ensureSpace(doc, y, 30);
    y = drawSectionHeader(doc, 'OBJETIVOS DE LA REUNIÓN', 3, margin, y, width);
    y = renderBulletList(doc, margin, y, sanitizeList(fd.objectives).length ? sanitizeList(fd.objectives) : ['No especificados'], width);

    // ==================== SECCIÓN 04: AGENDA ====================
    y = ensureSpace(doc, y, 30);
    y = drawSectionHeader(doc, 'AGENDA / PUNTOS TRATADOS', 4, margin, y, width);
    y = renderBulletList(doc, margin, y, sanitizeList(fd.agenda).length ? sanitizeList(fd.agenda) : ['No especificada'], width);

    // ==================== SECCIÓN 05: DECISIONES ====================
    y = ensureSpace(doc, y, 30);
    y = drawSectionHeader(doc, 'DECISIONES TOMADAS', 5, margin, y, width);
    y = renderBulletList(doc, margin, y, sanitizeList(fd.decisions).length ? sanitizeList(fd.decisions) : ['Ninguna'], width);

    // ==================== SECCIÓN 06: ACUERDOS ====================
    y = ensureSpace(doc, y, 30);
    y = drawSectionHeader(doc, 'ACUERDOS ALCANZADOS', 6, margin, y, width);
    y = renderBulletList(doc, margin, y, sanitizeList(fd.agreements).length ? sanitizeList(fd.agreements) : ['Ninguno'], width);

    // ==================== SECCIÓN 07: TAREAS ====================
    y = ensureSpace(doc, y, 30);
    y = drawSectionHeader(doc, 'ACCIONES ASIGNADAS', 7, margin, y, width);
    y = renderBulletList(doc, margin, y, sanitizeList(fd.assignedTasks).length ? sanitizeList(fd.assignedTasks) : ['Ninguna'], width);

    // ==================== SECCIÓN 08: PENDIENTES ====================
    y = ensureSpace(doc, y, 30);
    y = drawSectionHeader(doc, 'PUNTOS PENDIENTES', 8, margin, y, width);
    y = renderBulletList(doc, margin, y, sanitizeList(fd.pendingItems).length ? sanitizeList(fd.pendingItems) : ['Ninguno'], width);

    // ==================== SECCIÓN 09: PRÓXIMA REUNIÓN ====================
    y = ensureSpace(doc, y, 24);
    y = drawSectionHeader(doc, 'PRÓXIMA REUNIÓN', 9, margin, y, width);
    const proxFecha = fd.nextMeetingDate ? new Date(fd.nextMeetingDate).toLocaleDateString('es-ES') : 'No programada';
    y = renderKeyValue(doc, margin, y, 'Fecha', proxFecha, width);
    y = renderKeyValue(doc, margin, y, 'Tema', fd.nextMeetingTopic || 'No definido', width);

    // ==================== SECCIÓN 10: RECURSOS (opcional) ====================
    if (fd.sharedDocuments || fd.referenceLinks) {
        y = ensureSpace(doc, y, 30);
        y = drawSectionHeader(doc, 'RECURSOS Y DOCUMENTACIÓN', 10, margin, y, width);
        y = ensureSpace(doc, y, 16);
        doc.setFont('helvetica', 'bold'); doc.setFontSize(10); doc.setTextColor(55, 65, 81);
        doc.text('Documentos Compartidos', margin, y);
        y += 5;
        y = renderBulletList(doc, margin, y, sanitizeList(fd.sharedDocuments).length ? sanitizeList(fd.sharedDocuments) : ['Ninguno'], width);

        y = ensureSpace(doc, y, 20);
        doc.setFont('helvetica', 'bold'); doc.text('Enlaces de Referencia', margin, y);
        y += 5;
        y = renderBulletList(doc, margin, y, sanitizeList(fd.referenceLinks).length ? sanitizeList(fd.referenceLinks) : ['Ninguno'], width);
    }

    // ==================== SECCIÓN 11: NOTAS (opcional) ====================
    if (fd.additionalNotes || fd.moderatorNotes) {
        y = ensureSpace(doc, y, 30);
        y = drawSectionHeader(doc, 'NOTAS Y OBSERVACIONES', 11, margin, y, width);
        y = ensureSpace(doc, y, 16);
        doc.setFont('helvetica', 'bold'); doc.setFontSize(10); doc.setTextColor(55, 65, 81);
        doc.text('Notas Adicionales', margin, y); y += 5;
        y = renderBulletList(doc, margin, y, sanitizeList(fd.additionalNotes).length ? sanitizeList(fd.additionalNotes) : ['Ninguna'], width);

        y = ensureSpace(doc, y, 16);
        doc.setFont('helvetica', 'bold'); doc.text('Observaciones del Moderador', margin, y); y += 5;
        y = renderBulletList(doc, margin, y, sanitizeList(fd.moderatorNotes).length ? sanitizeList(fd.moderatorNotes) : ['Ninguna'], width);
    }

    // ==================== SECCIÓN 12: REDACTOR ====================
    y = ensureSpace(doc, y, 24);
    y = drawSectionHeader(doc, 'INFORMACIÓN DEL REDACTOR', 12, margin, y, width);
    y = renderKeyValue(doc, margin, y, 'Secretario/Redactor', fd.secretary || 'No especificado', width);
    y = renderKeyValue(doc, margin, y, 'Departamento', fd.department || 'No especificado', width);
    y = renderKeyValue(doc, margin, y, 'Email de Contacto', fd.secretaryEmail || 'No especificado', width);

    // Footer en todas las páginas
    const pageCount = doc.internal.getNumberOfPages();
    for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(8);
        doc.setTextColor(128, 128, 128);
        doc.text(`Meetlyzer Pro - Página ${i} de ${pageCount}`, margin, 285);
        doc.text('Documento Confidencial - Uso Interno', 120, 285);
    }

    // Guardar
    const fileName = generateFileName();
    doc.save(`${fileName}.pdf`);

    alert(`Informe de reunión generado exitosamente: ${fileName}.pdf`);

    if (confirm('¿Desea limpiar el formulario para una nueva reunión?')) {
        document.getElementById('meetingForm').reset();
        setDefaultDate();
        updateMeetingNumber();
    }
}

// ==================== REEMPLAZO: showPreview() ====================
function showPreview() {
    const previewContent = document.getElementById('previewContent');

    // facilita listas bonitas
    const toList = (txt, empty = '—') => {
        const items = sanitizeList(txt);
        if (!items.length) return `<div class="text-gray-400">${empty}</div>`;
        return `<ul class="list-disc pl-6 space-y-1">${items.map(i => `<li>${i}</li>`).join('')}</ul>`;
    };
    const val = (v, empty = 'No especificado') => v && v.trim() ? v : `<span class="text-gray-400">${empty}</span>`;
    const dt = v => v ? new Date(v).toLocaleDateString('es-ES') : '';

    const html = `
    <div class="space-y-6">
      <!-- RESUMEN -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">01</span>
          <h3 class="text-lg font-semibold text-blue-700">Resumen de la Reunión</h3>
        </div>

        <div class="mb-3">
          <div class="text-base font-semibold text-gray-900">${val(document.getElementById('meetingTitle').value, 'Título no especificado')}</div>
          <div class="mt-2 flex flex-wrap gap-2">
            <span class="px-2 py-1 rounded-full bg-blue-50 text-blue-600 text-xs font-semibold">Tipo: ${val(document.getElementById('meetingType').value, 'N/D')}</span>
            <span class="px-2 py-1 rounded-full bg-blue-50 text-blue-600 text-xs font-semibold">Modalidad: ${val(document.getElementById('modality').value, 'N/D')}</span>
            <span class="px-2 py-1 rounded-full bg-blue-50 text-blue-600 text-xs font-semibold">Participantes: ${val(document.getElementById('totalParticipants').value, 'N/D')}</span>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
          <div><span class="font-semibold text-gray-700">Fecha:</span> ${val(dt(document.getElementById('meetingDate').value), 'No especificada')}</div>
          <div><span class="font-semibold text-gray-700">Horario:</span> ${val(`${document.getElementById('startTime').value || 'N/A'} – ${document.getElementById('endTime').value || 'N/A'}`, 'N/A')}</div>
          <div><span class="font-semibold text-gray-700">Lugar/Plataforma:</span> ${val(document.getElementById('location').value)}</div>
          <div><span class="font-semibold text-gray-700">Organizador:</span> ${val(document.getElementById('organizer').value)}</div>
        </div>
      </section>

      <!-- PARTICIPANTES -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">02</span>
          <h3 class="text-lg font-semibold text-blue-700">Participantes y Asistencia</h3>
        </div>
        <div class="text-sm mb-2"><span class="font-semibold text-gray-700">Total:</span> ${val(document.getElementById('totalParticipants').value)}</div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <div class="font-semibold text-gray-700 mb-1">Asistentes Confirmados</div>
            ${toList(document.getElementById('attendees').value, 'No especificados')}
          </div>
          <div>
            <div class="font-semibold text-gray-700 mb-1">Ausentes Justificados</div>
            ${toList(document.getElementById('absentees').value, 'Ninguno')}
          </div>
          <div>
            <div class="font-semibold text-gray-700 mb-1">Invitados Externos</div>
            ${toList(document.getElementById('externalGuests').value, 'Ninguno')}
          </div>
        </div>
      </section>

      <!-- OBJETIVOS -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">03</span>
          <h3 class="text-lg font-semibold text-blue-700">Objetivos de la Reunión</h3>
        </div>
        ${toList(document.getElementById('objectives').value, 'No especificados')}
      </section>

      <!-- AGENDA -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">04</span>
          <h3 class="text-lg font-semibold text-blue-700">Agenda / Puntos Tratados</h3>
        </div>
        ${toList(document.getElementById('agenda').value, 'No especificada')}
      </section>

      <!-- DECISIONES Y ACUERDOS -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">05</span>
          <h3 class="text-lg font-semibold text-blue-700">Decisiones y Acuerdos</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <div class="font-semibold text-gray-700 mb-1">Decisiones Tomadas</div>
            ${toList(document.getElementById('decisions').value, 'Ninguna')}
          </div>
          <div>
            <div class="font-semibold text-gray-700 mb-1">Acuerdos Alcanzados</div>
            ${toList(document.getElementById('agreements').value, 'Ninguno')}
          </div>
        </div>
      </section>

      <!-- TAREAS Y PENDIENTES -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">06</span>
          <h3 class="text-lg font-semibold text-blue-700">Tareas y Seguimiento</h3>
        </div>
        <div class="mb-3">
          <div class="font-semibold text-gray-700 mb-1">Acciones Asignadas</div>
          ${toList(document.getElementById('assignedTasks').value, 'Ninguna')}
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div>
            <div class="font-semibold text-gray-700 mb-1">Puntos Pendientes</div>
            ${toList(document.getElementById('pendingItems').value, 'Ninguno')}
          </div>
          <div>
            <div class="font-semibold text-gray-700 mb-1">Próxima Reunión</div>
            <div><span class="font-semibold">Fecha:</span> ${document.getElementById('nextMeetingDate').value ? new Date(document.getElementById('nextMeetingDate').value).toLocaleDateString('es-ES') : '<span class="text-gray-400">No programada</span>'}</div>
            <div><span class="font-semibold">Tema:</span> ${val(document.getElementById('nextMeetingTopic').value, 'No definido')}</div>
          </div>
        </div>
      </section>

      <!-- RECURSOS (opcional) -->
      ${(document.getElementById('sharedDocuments').value || document.getElementById('referenceLinks').value) ? `
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">07</span>
          <h3 class="text-lg font-semibold text-blue-700">Recursos y Documentación</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <div class="font-semibold text-gray-700 mb-1">Documentos Compartidos</div>
            ${toList(document.getElementById('sharedDocuments').value, 'Ninguno')}
          </div>
          <div>
            <div class="font-semibold text-gray-700 mb-1">Enlaces de Referencia</div>
            ${toList(document.getElementById('referenceLinks').value, 'Ninguno')}
          </div>
        </div>
      </section>` : ''}

      <!-- NOTAS (opcional) -->
      ${(document.getElementById('additionalNotes').value || document.getElementById('moderatorNotes').value) ? `
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">08</span>
          <h3 class="text-lg font-semibold text-blue-700">Notas y Observaciones</h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <div class="font-semibold text-gray-700 mb-1">Notas Adicionales</div>
            ${toList(document.getElementById('additionalNotes').value, 'Ninguna')}
          </div>
          <div>
            <div class="font-semibold text-gray-700 mb-1">Observaciones del Moderador</div>
            ${toList(document.getElementById('moderatorNotes').value, 'Ninguna')}
          </div>
        </div>
      </section>` : ''}

      <!-- REDACTOR -->
      <section class="border rounded-xl p-4 bg-white shadow-sm">
        <div class="flex items-center gap-2 mb-3">
          <span class="inline-flex items-center justify-center h-6 w-6 rounded-full bg-blue-600 text-white text-xs font-bold">09</span>
          <h3 class="text-lg font-semibold text-blue-700">Información del Redactor</h3>
        </div>
        <div class="text-sm">
          <div><span class="font-semibold text-gray-700">Secretario/Redactor:</span> ${val(document.getElementById('secretary').value)}</div>
          <div><span class="font-semibold text-gray-700">Departamento:</span> ${val(document.getElementById('department').value)}</div>
          <div><span class="font-semibold text-gray-700">Email:</span> ${val(document.getElementById('secretaryEmail').value)}</div>
        </div>
      </section>
    </div>
    `;

    previewContent.innerHTML = html;
    document.getElementById('previewModal').classList.remove('hidden');
    document.getElementById('previewModal').classList.add('flex');
}
// ==================== FIN NUEVO RENDER DEL INFORME ====================


</body>
</html>
