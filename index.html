<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetlyzer - Sistema de Gestión de Reuniones</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            min-height: 100vh;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
        }
        
        .form-input {
            transition: all 0.3s ease;
            border: 2px solid #e2e8f0;
        }
        
        .form-input:focus {
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .priority-high {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .priority-medium {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        
        .priority-low {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }
        
        .meeting-card {
            transition: all 0.3s ease;
        }
        
        .meeting-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        @media print {
            body {
                background: white !important;
            }
            .glass-effect {
                background: white !important;
                backdrop-filter: none !important;
                border: 1px solid #e2e8f0 !important;
            }
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass-effect rounded-2xl p-8 mb-6 shadow-2xl">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-sky-500 to-blue-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold gradient-text">Meetlyzer</h1>
                        <p class="text-gray-600 font-medium">Sistema Profesional de Gestión de Reuniones</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500">Reunión No.:</div>
                    <div id="meetingNumber" class="text-2xl font-bold text-blue-600">#0001</div>
                </div>
            </div>
        </div>

        <!-- Main Form -->
        <div class="glass-effect rounded-2xl p-8 shadow-2xl">
            <form id="meetingForm">
                <!-- Información General -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                        Información General de la Reunión
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Título/Asunto de la Reunión</label>
                            <input type="text" id="meetingTitle" placeholder="Ej: Revisión Mensual de Proyectos Q4" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Tipo de Reunión</label>
                            <select id="meetingType" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                                <option value="">Seleccionar tipo...</option>
                                <option value="estrategica">Estratégica</option>
                                <option value="operativa">Operativa</option>
                                <option value="seguimiento">Seguimiento</option>
                                <option value="planificacion">Planificación</option>
                                <option value="revision">Revisión</option>
                                <option value="brainstorming">Brainstorming</option>
                                <option value="capacitacion">Capacitación</option>
                                <option value="presentacion">Presentación</option>
                                <option value="comite">Comité</option>
                                <option value="directorio">Directorio</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Fecha de la Reunión</label>
                            <input type="date" id="meetingDate" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Hora de Inicio</label>
                            <input type="time" id="startTime" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Hora de Fin</label>
                            <input type="time" id="endTime" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Modalidad</label>
                            <select id="modality" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                                <option value="presencial">Presencial</option>
                                <option value="virtual">Virtual</option>
                                <option value="hibrida">Híbrida</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Lugar/Plataforma</label>
                            <input type="text" id="location" placeholder="Ej: Sala de Juntas A / Zoom / Teams" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Organizador/Moderador</label>
                            <input type="text" id="organizer" placeholder="Nombre del organizador" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Participantes -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-user-friends text-green-600 mr-3"></i>
                        Participantes y Asistencia
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Asistentes Confirmados</label>
                            <textarea id="attendees" rows="4" placeholder="• Juan Pérez - Director General&#10;• María González - Jefa de Proyectos&#10;• Carlos Ruiz - Analista Senior" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ausentes Justificados</label>
                            <textarea id="absentees" rows="4" placeholder="• Ana López - Vacaciones&#10;• Pedro Martín - Viaje de negocios" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Invitados Externos</label>
                            <textarea id="externalGuests" rows="3" placeholder="• Consultor ABC - asesor@consultora.com&#10;• Cliente XYZ - contacto@cliente.com" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Total de Participantes</label>
                            <input type="number" id="totalParticipants" min="1" placeholder="8" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Contenido de la Reunión -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-clipboard-list text-purple-600 mr-3"></i>
                        Contenido y Desarrollo
                    </h2>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Objetivos de la Reunión</label>
                        <textarea id="objectives" rows="3" placeholder="• Revisar el progreso del Q4&#10;• Definir estrategia para el próximo trimestre&#10;• Aprobar presupuesto 2024" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Agenda/Puntos Tratados</label>
                        <textarea id="agenda" rows="5" placeholder="1. Bienvenida y introducción (10 min)&#10;2. Revisión de proyectos actuales (30 min)&#10;3. Análisis de resultados Q4 (20 min)&#10;4. Planificación Q1 2024 (25 min)&#10;5. Otros temas y cierre (10 min)" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Decisiones Tomadas</label>
                            <textarea id="decisions" rows="4" placeholder="• Aprobado presupuesto adicional para Proyecto Alpha&#10;• Se posterga lanzamiento del Producto B hasta marzo&#10;• Contratación de 2 desarrolladores adicionales" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Acuerdos Alcanzados</label>
                            <textarea id="agreements" rows="4" placeholder="• Reuniones de seguimiento semanales los lunes&#10;• Reportes de progreso cada viernes&#10;• Revisión mensual de KPIs" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Tareas y Seguimiento -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-tasks text-orange-600 mr-3"></i>
                        Tareas y Seguimiento
                    </h2>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Acciones Asignadas</label>
                        <textarea id="assignedTasks" rows="6" placeholder="• María González - Preparar documento de requisitos | Fecha límite: 15/12/2023 | Prioridad: Alta&#10;• Carlos Ruiz - Analizar costos del nuevo sistema | Fecha límite: 20/12/2023 | Prioridad: Media&#10;• Juan Pérez - Coordinar reunión con proveedores | Fecha límite: 18/12/2023 | Prioridad: Alta" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Puntos Pendientes</label>
                            <textarea id="pendingItems" rows="4" placeholder="• Definir métricas de éxito para Q1&#10;• Revisar contratos con proveedores actuales&#10;• Validar disponibilidad de recursos técnicos" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Próxima Reunión</label>
                            <div class="space-y-3">
                                <input type="date" id="nextMeetingDate" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                                <input type="text" id="nextMeetingTopic" placeholder="Tema de la próxima reunión" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recursos y Documentos -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-folder-open text-indigo-600 mr-3"></i>
                        Recursos y Documentación
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Documentos Compartidos</label>
                            <textarea id="sharedDocuments" rows="4" placeholder="• Presentación Q4 Results.pptx&#10;• Budget_2024_Draft.xlsx&#10;• Project_Alpha_Timeline.pdf&#10;• Market_Analysis_Report.docx" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Enlaces de Referencia</label>
                            <textarea id="referenceLinks" rows="4" placeholder="• Dashboard de proyectos: https://dashboard.empresa.com&#10;• Repositorio de documentos: https://docs.empresa.com&#10;• Sistema de tickets: https://tickets.empresa.com" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Notas y Observaciones -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-sticky-note text-yellow-600 mr-3"></i>
                        Notas y Observaciones
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Notas Adicionales</label>
                            <textarea id="additionalNotes" rows="5" placeholder="• Excelente participación del equipo&#10;• Se identificaron nuevas oportunidades de mejora&#10;• Necesario reforzar comunicación interdepartamental&#10;• Cliente mostró satisfacción con los avances" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Observaciones del Moderador</label>
                            <textarea id="moderatorNotes" rows="5" placeholder="• Reunión muy productiva y enfocada&#10;• Todos los puntos de agenda fueron cubiertos&#10;• Se superaron las expectativas de participación&#10;• Recomendación: mantener este formato para futuras reuniones" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none resize-none"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Información del Redactor -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-user-edit text-teal-600 mr-3"></i>
                        Información del Redactor
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Secretario/Redactor</label>
                            <input type="text" id="secretary" placeholder="Nombre del redactor" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Departamento/Área</label>
                            <input type="text" id="department" placeholder="Ej: Administración, RRHH, IT" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Email de Contacto</label>
                            <input type="email" id="secretaryEmail" placeholder="secretario@empresa.com" class="form-input w-full px-4 py-3 rounded-lg focus:outline-none">
                        </div>
                    </div>
                </div>

                <!-- Botones de Acción -->
                <div class="flex flex-col sm:flex-row gap-4 pt-8 border-t border-gray-200">
                    <button type="button" id="previewBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-eye mr-2"></i>
                        Vista Previa
                    </button>
                    
                    <button type="button" id="saveBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg transition-all duration-300 flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i>
                        Guardar Borrador
                    </button>
                    
                    <button type="button" id="generateBtn" class="flex-1 btn-primary text-white font-semibold py-4 px-6 rounded-lg flex items-center justify-center">
                        <i class="fas fa-file-pdf mr-2"></i>
                        Finalizar y Generar PDF
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Vista Previa -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl max-w-5xl max-h-96 overflow-y-auto p-8 w-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Vista Previa del Informe de Reunión</h2>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="previewContent" class="space-y-4"></div>
        </div>
    </div>

    <script>
    // =========================
    // NUEVA VISIÓN DE INFORME
    // (PDF + VISTA PREVIA MODAL)
    // =========================

    // Generar PDF (reemplazo completo)
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // --- Configuración base ---
        const MARGIN = 20;
        const CONTENT_W = 170; // 210 - 2*20
        const BRAND = { r: 14, g: 165, b: 233 }; // sky-500
        const LINE_H = 6.5;
        let y = MARGIN;

        // Helper: salto de página si no hay espacio
        function need(h) {
            if (y + h > 287) { // margen inferior ~10
                doc.addPage();
                y = MARGIN;
            }
        }

        // Helper: separador sutil
        function divider(spaceTop = 6, spaceBottom = 6) {
            need(spaceTop + 2 + spaceBottom);
            y += spaceTop;
            doc.setDrawColor(226, 232, 240); // slate-200
            doc.setLineWidth(0.4);
            doc.line(MARGIN, y, MARGIN + CONTENT_W, y);
            y += spaceBottom;
        }

        // Helper: título de sección con banda de color
        function section(title) {
            const BAND_H = 9;
            need(BAND_H + 5);
            doc.setFillColor(236, 253, 255); // sky-50
            doc.rect(MARGIN, y, CONTENT_W, BAND_H, 'F');
            doc.setTextColor(BRAND.r, BRAND.g, BRAND.b);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text(title.toUpperCase(), MARGIN + 3, y + 6.5);
            y += BAND_H + 3;
            doc.setTextColor(0, 0, 0);
            doc.setFont('helvetica', 'normal');
        }

        // Helper: par clave:valor con columnas (etiqueta fija)
        function kv(label, value, labelW = 48) {
            const v = (value && String(value).trim()) ? String(value) : 'No especificado';
            const xLabel = MARGIN;
            const xVal = MARGIN + labelW + 2;
            const maxW = CONTENT_W - labelW - 2;

            // etiqueta
            need(LINE_H);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.text(label + ':', xLabel, y);
            // valor envuelto
            doc.setFont('helvetica', 'normal');
            const lines = doc.splitTextToSize(v, maxW);
            lines.forEach((ln, i) => {
                need(LINE_H);
                doc.text(ln, xVal, y);
                y += LINE_H;
            });
        }

        // Helper: bloque con título + lista con viñetas y espacio entre puntos
        function bulletedBlock(title, text) {
            const content = (text || '').split('\n').map(s => s.trim()).filter(Boolean);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            need(LINE_H);
            doc.text(title + ':', MARGIN, y);
            y += 3.5;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);

            const items = content.length ? content : ['No especificado'];
            items.forEach(item => {
                const wrapped = doc.splitTextToSize('• ' + item, CONTENT_W - 4);
                wrapped.forEach((ln) => {
                    need(LINE_H);
                    doc.text(ln, MARGIN + 2, y);
                    y += LINE_H;
                });
                y += 2; // espacio extra entre puntos
            });
            y += 2;
        }

        // Helper: chips (píldoras) informativas
        function pill(text, bg = {r: 219,g: 234,b: 254}, color = {r: 37,g: 99,b: 235}) { // blue-100 / blue-600
            const padX = 3;
            const padY = 2.5;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(9);
            const w = doc.getTextWidth(text) + padX * 2;
            const h = 6.5;
            need(h + 2);
            doc.setFillColor(bg.r, bg.g, bg.b);
            doc.rect(MARGIN, y - (h - 4), w, h, 'F');
            doc.setTextColor(color.r, color.g, color.b);
            doc.text(text, MARGIN + padX, y);
            doc.setTextColor(0, 0, 0);
            return w + 3;
        }

        // --- Cabecera ---
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(18);
        doc.setTextColor(BRAND.r, BRAND.g, BRAND.b);
        doc.text('INFORME DE REUNIÓN', MARGIN, y);
        doc.setFontSize(11);
        doc.setTextColor(71, 85, 105); // slate-600
        doc.setFont('helvetica', 'normal');
        const meetingNum = document.getElementById('meetingNumber').textContent;
        doc.text('Meetlyzer Pro — ' + meetingNum, MARGIN, y + 7.5);
        const nowStr = new Date().toLocaleString('es-ES');
        doc.text(`Generado: ${nowStr}`, MARGIN + 110, y + 7.5);
        y += 16;

        // Píldoras: Tipo y Modalidad (si existen)
        let offsetX = 0;
        const type = document.getElementById('meetingType').value || 'Tipo no especificado';
        offsetX += pill('Tipo: ' + type);
        doc.setPage(doc.internal.getCurrentPageInfo().pageNumber); // mantener estado
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(9);
        doc.setTextColor(71, 85, 105);
        // segunda píldora en la misma línea
        const modality = document.getElementById('modality').value || 'Modalidad no especificada';
        doc.setFillColor(219, 234, 254);
        doc.rect(MARGIN + offsetX, y - 2.5, doc.getTextWidth('Modalidad: ' + modality) + 6, 6.5, 'F');
        doc.text('Modalidad: ' + modality, MARGIN + offsetX + 3, y + 2);
        doc.setTextColor(0, 0, 0);
        y += 8;
        divider(6, 6);

        // --- Recopilar datos ---
        const formData = {
            meetingTitle: document.getElementById('meetingTitle').value,
            meetingType: document.getElementById('meetingType').value,
            meetingDate: document.getElementById('meetingDate').value,
            startTime: document.getElementById('startTime').value,
            endTime: document.getElementById('endTime').value,
            modality: document.getElementById('modality').value,
            location: document.getElementById('location').value,
            organizer: document.getElementById('organizer').value,
            attendees: document.getElementById('attendees').value,
            absentees: document.getElementById('absentees').value,
            externalGuests: document.getElementById('externalGuests').value,
            totalParticipants: document.getElementById('totalParticipants').value,
            objectives: document.getElementById('objectives').value,
            agenda: document.getElementById('agenda').value,
            decisions: document.getElementById('decisions').value,
            agreements: document.getElementById('agreements').value,
            assignedTasks: document.getElementById('assignedTasks').value,
            pendingItems: document.getElementById('pendingItems').value,
            nextMeetingDate: document.getElementById('nextMeetingDate').value,
            nextMeetingTopic: document.getElementById('nextMeetingTopic').value,
            sharedDocuments: document.getElementById('sharedDocuments').value,
            referenceLinks: document.getElementById('referenceLinks').value,
            additionalNotes: document.getElementById('additionalNotes').value,
            moderatorNotes: document.getElementById('moderatorNotes').value,
            secretary: document.getElementById('secretary').value,
            department: document.getElementById('department').value,
            secretaryEmail: document.getElementById('secretaryEmail').value
        };

        // --- Estado del informe (completitud) ---
        const keysForStatus = [
            'meetingTitle','meetingType','meetingDate','startTime','endTime','modality','location','organizer',
            'attendees','objectives','agenda','decisions','agreements','assignedTasks','pendingItems'
        ];
        const filled = keysForStatus.filter(k => formData[k] && String(formData[k]).trim().length > 0).length;
        const completeness = Math.round((filled / keysForStatus.length) * 100);

        doc.setFillColor(243, 244, 246); // gray-100
        need(15);
        doc.rect(MARGIN, y, CONTENT_W, 12, 'F');
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(31, 41, 55); // gray-800
        doc.text('ESTADO DEL INFORME', MARGIN + 3, y + 7.5);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(71, 85, 105);
        doc.text(`Completitud: ${completeness}%`, MARGIN + CONTENT_W - 40, y + 7.5, { align: 'right' });
        y += 18;

        // ========== SECCIONES ESTRUCTURADAS ==========

        // 1. Información General
        section('Información General');
        kv('Título/Asunto', formData.meetingTitle);
        kv('Fecha', formData.meetingDate ? new Date(formData.meetingDate).toLocaleDateString('es-ES') : '');
        kv('Horario', (formData.startTime || 'N/A') + ' - ' + (formData.endTime || 'N/A'));
        kv('Lugar/Plataforma', formData.location);
        kv('Organizador', formData.organizer);
        divider();

        // 2. Participantes y Asistencia
        section('Participantes y Asistencia');
        kv('Total participantes', formData.totalParticipants || '');
        bulletedBlock('Asistentes confirmados', formData.attendees);
        bulletedBlock('Ausentes justificados', formData.absentees);
        bulletedBlock('Invitados externos', formData.externalGuests);
        divider();

        // 3. Objetivos y Agenda
        section('Contenido y Desarrollo');
        bulletedBlock('Objetivos de la reunión', formData.objectives);
        bulletedBlock('Agenda / Puntos tratados', formData.agenda);
        divider();

        // 4. Decisiones y Acuerdos
        section('Decisiones y Acuerdos');
        bulletedBlock('Decisiones tomadas', formData.decisions);
        bulletedBlock('Acuerdos alcanzados', formData.agreements);
        divider();

        // 5. Tareas y Seguimiento
        section('Tareas y Seguimiento');
        bulletedBlock('Acciones asignadas', formData.assignedTasks);
        bulletedBlock('Puntos pendientes', formData.pendingItems);
        kv('Próxima reunión', formData.nextMeetingDate ? new Date(formData.nextMeetingDate).toLocaleDateString('es-ES') : 'No programada');
        kv('Tema próxima reunión', formData.nextMeetingTopic || 'No definido');
        divider();

        // 6. Recursos y Documentación (opcional)
        if (formData.sharedDocuments || formData.referenceLinks) {
            section('Recursos y Documentación');
            bulletedBlock('Documentos compartidos', formData.sharedDocuments);
            bulletedBlock('Enlaces de referencia', formData.referenceLinks);
            divider();
        }

        // 7. Notas y Observaciones (opcional)
        if (formData.additionalNotes || formData.moderatorNotes) {
            section('Notas y Observaciones');
            bulletedBlock('Notas adicionales', formData.additionalNotes);
            bulletedBlock('Observaciones del moderador', formData.moderatorNotes);
            divider();
        }

        // 8. Información del Redactor
        section('Información del Redactor');
        kv('Secretario/Redactor', formData.secretary);
        kv('Departamento/Área', formData.department);
        kv('Email de contacto', formData.secretaryEmail);

        // --- Footer en todas las páginas ---
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text(`Meetlyzer Pro - Página ${i} de ${pageCount}`, MARGIN, 290);
            doc.text('Documento Confidencial - Uso Interno', MARGIN + 100, 290);
        }

        // --- Guardar PDF y flujos existentes ---
        const fileName = generateFileName();
        doc.save(`${fileName}.pdf`);
        alert(`Informe de reunión generado exitosamente: ${fileName}.pdf`);

        if (confirm('¿Desea limpiar el formulario para una nueva reunión?')) {
            document.getElementById('meetingForm').reset();
            setDefaultDate();
            updateMeetingNumber();
        }
    }

    // Vista previa (reemplazo completo)
    function showPreview() {
        const el = id => document.getElementById(el = id).value;
        const safe = s => (s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
        const toList = (txt) => {
            const items = (txt || '').split('\n').map(t => t.trim()).filter(Boolean);
            if (!items.length) return '<p class="text-gray-500">No especificado</p>';
            return `<ul class="list-disc pl-6 space-y-2">${items.map(i => `<li>${safe(i)}</li>`).join('')}</ul>`;
        };

        // Estado (completitud)
        const data = {
            meetingTitle: el('meetingTitle'),
            meetingType: el('meetingType'),
            meetingDate: el('meetingDate'),
            startTime: el('startTime'),
            endTime: el('endTime'),
            modality: el('modality'),
            location: el('location'),
            organizer: el('organizer'),
            attendees: el('attendees'),
            absentees: el('absentees'),
            externalGuests: el('externalGuests'),
            totalParticipants: el('totalParticipants'),
            objectives: el('objectives'),
            agenda: el('agenda'),
            decisions: el('decisions'),
            agreements: el('agreements'),
            assignedTasks: el('assignedTasks'),
            pendingItems: el('pendingItems'),
            nextMeetingDate: el('nextMeetingDate'),
            nextMeetingTopic: el('nextMeetingTopic'),
            sharedDocuments: el('sharedDocuments'),
            referenceLinks: el('referenceLinks'),
            additionalNotes: el('additionalNotes'),
            moderatorNotes: el('moderatorNotes'),
            secretary: el('secretary'),
            department: el('department'),
            secretaryEmail: el('secretaryEmail')
        };

        const keysForStatus = [
            'meetingTitle','meetingType','meetingDate','startTime','endTime','modality','location','organizer',
            'attendees','objectives','agenda','decisions','agreements','assignedTasks','pendingItems'
        ];
        const filled = keysForStatus.filter(k => data[k] && String(data[k]).trim().length > 0).length;
        const completeness = Math.round((filled / keysForStatus.length) * 100);

        const previewContent = document.getElementById('previewContent');
        const meetingNum = document.getElementById('meetingNumber').textContent;

        const fechaStr = data.meetingDate ? new Date(data.meetingDate).toLocaleDateString('es-ES') : 'No especificada';
        const proxStr  = data.nextMeetingDate ? new Date(data.nextMeetingDate).toLocaleDateString('es-ES') : 'No programada';

        const badge = (txt) => `<span class="inline-block px-2.5 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-semibold">${safe(txt)}</span>`;

        const html = `
            <div class="space-y-6">
                <!-- Resumen / encabezado -->
                <div class="rounded-xl border border-gray-200 p-4 bg-gray-50">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                        <div>
                            <div class="text-sm text-gray-500">Informe</div>
                            <div class="text-lg font-semibold text-gray-800">${safe(meetingNum)} · ${safe(data.meetingTitle) || 'Sin título'}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            ${badge('Tipo: ' + (data.meetingType || '—'))}
                            ${badge('Modalidad: ' + (data.modality || '—'))}
                            ${badge('Completitud: ' + completeness + '%')}
                        </div>
                    </div>
                </div>

                <!-- Información General -->
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">INFORMACIÓN GENERAL</h3>
                    </div>
                    <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div><span class="font-semibold text-gray-700">Fecha:</span> ${safe(fechaStr)}</div>
                        <div><span class="font-semibold text-gray-700">Horario:</span> ${(safe(data.startTime) || 'N/A')} - ${(safe(data.endTime) || 'N/A')}</div>
                        <div><span class="font-semibold text-gray-700">Lugar/Plataforma:</span> ${safe(data.location) || 'No especificado'}</div>
                        <div><span class="font-semibold text-gray-700">Organizador:</span> ${safe(data.organizer) || 'No especificado'}</div>
                        <div><span class="font-semibold text-gray-700">Participantes:</span> ${safe(data.totalParticipants) || 'No especificado'}</div>
                    </div>
                </div>

                <!-- Participantes y Asistencia -->
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">PARTICIPANTES Y ASISTENCIA</h3>
                    </div>
                    <div class="p-4 space-y-4 text-sm">
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Asistentes confirmados</div>
                            ${toList(data.attendees)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Ausentes justificados</div>
                            ${toList(data.absentees)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Invitados externos</div>
                            ${toList(data.externalGuests)}
                        </div>
                    </div>
                </div>

                <!-- Contenido y Desarrollo -->
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">CONTENIDO Y DESARROLLO</h3>
                    </div>
                    <div class="p-4 space-y-4 text-sm">
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Objetivos de la reunión</div>
                            ${toList(data.objectives)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Agenda / Puntos tratados</div>
                            ${toList(data.agenda)}
                        </div>
                    </div>
                </div>

                <!-- Decisiones y Acuerdos -->
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">DECISIONES Y ACUERDOS</h3>
                    </div>
                    <div class="p-4 space-y-4 text-sm">
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Decisiones tomadas</div>
                            ${toList(data.decisions)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Acuerdos alcanzados</div>
                            ${toList(data.agreements)}
                        </div>
                    </div>
                </div>

                <!-- Tareas y Seguimiento -->
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">TAREAS Y SEGUIMIENTO</h3>
                    </div>
                    <div class="p-4 space-y-4 text-sm">
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Acciones asignadas</div>
                            ${toList(data.assignedTasks)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Puntos pendientes</div>
                            ${toList(data.pendingItems)}
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><span class="font-semibold text-gray-700">Próxima reunión:</span> ${safe(proxStr)}</div>
                            <div><span class="font-semibold text-gray-700">Tema:</span> ${safe(data.nextMeetingTopic) || 'No definido'}</div>
                        </div>
                    </div>
                </div>

                <!-- Recursos y Documentación (opcional) -->
                ${(data.sharedDocuments || data.referenceLinks) ? `
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">RECURSOS Y DOCUMENTACIÓN</h3>
                    </div>
                    <div class="p-4 space-y-4 text-sm">
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Documentos compartidos</div>
                            ${toList(data.sharedDocuments)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Enlaces de referencia</div>
                            ${toList(data.referenceLinks)}
                        </div>
                    </div>
                </div>` : ''}

                <!-- Notas y Observaciones (opcional) -->
                ${(data.additionalNotes || data.moderatorNotes) ? `
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">NOTAS Y OBSERVACIONES</h3>
                    </div>
                    <div class="p-4 space-y-4 text-sm">
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Notas adicionales</div>
                            ${toList(data.additionalNotes)}
                        </div>
                        <div>
                            <div class="font-semibold text-gray-700 mb-1">Observaciones del moderador</div>
                            ${toList(data.moderatorNotes)}
                        </div>
                    </div>
                </div>` : ''}

                <!-- Información del Redactor -->
                <div class="rounded-xl border border-gray-200">
                    <div class="px-4 py-2 bg-blue-50 border-b border-blue-100 rounded-t-xl">
                        <h3 class="text-sm font-bold text-blue-700 tracking-wide">INFORMACIÓN DEL REDACTOR</h3>
                    </div>
                    <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div><span class="font-semibold text-gray-700">Secretario/Redactor:</span> ${safe(data.secretary) || 'No especificado'}</div>
                        <div><span class="font-semibold text-gray-700">Departamento/Área:</span> ${safe(data.department) || 'No especificado'}</div>
                        <div><span class="font-semibold text-gray-700">Email:</span> ${safe(data.secretaryEmail) || 'No especificado'}</div>
                    </div>
                </div>
            </div>
        `;

        previewContent.innerHTML = html;
        document.getElementById('previewModal').classList.remove('hidden');
        document.getElementById('previewModal').classList.add('flex');
    }
</script>

</body>
</html>
